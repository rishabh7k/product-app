{% extends 'products/base.html' %}

{% block content %}
<div class="product-detail-container">
  <div class="left-section">
    <!-- Debug information -->
    <div style="background: #f8f8f8; padding: 10px; margin-bottom: 10px;">
      <p>Debug Info:</p>
      <p>Product name: {{ product.name }}</p>
      <p>Images count: {{ product.images.all|length }}</p>
      <p>Raw images data: {{ product.images.all }}</p>
    </div>

    <div class="slideshow-container">
      {% if product.images.all %}
        {% for image in product.images.all %}
        <div class="mySlides fade">
          <p>Image URL: {{ image.url }}</p>
          <img src="{{ image.url }}" alt="{{ product.name }}" style="width:100%; display:block;">
        </div>
        {% empty %}
        <p>No images found in for loop</p>
        {% endfor %}
      {% else %}
        <p>No images available</p>
      {% endif %}
    </div>
  </div>
  
  <div class="right-section">
    <h2>{{ product.name }}</h2>
    <p>{{ product.description }}</p>
    <p>Price: ${{ product.price }}</p>
    <button class="add-to-cart-btn">Add to Cart</button>
  </div>
</div>

<style>
.product-detail-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  padding: 20px;
}

.left-section {
  position: relative;
}

.slideshow-container {
  position: relative;
  background: #f8f8f8;
  border-radius: 8px;
  overflow: hidden;
}

.mySlides {
  display: none;
  width: 100%;
  aspect-ratio: 4/3;
}

.mySlides img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.mySlides:first-child {
  display: block;
}

.prev, .next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  padding: 16px;
  color: white;
  background: rgba(0, 0, 0, 0.4);
  cursor: pointer;
  z-index: 2;
}

.prev { left: 0; border-radius: 0 3px 3px 0; }
.next { right: 0; border-radius: 3px 0 0 3px; }

.dot {
  height: 12px;
  width: 12px;
  margin: 0 4px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.dot.active {
  background-color: #ff6f61;
}

@media (max-width: 768px) {
  .product-detail-container {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  let slideIndex = 1;
  const slides = document.getElementsByClassName("mySlides");
  const dots = document.getElementsByClassName("dot");
  
  if (slides.length === 0) return;

  function showSlides(n) {
    if (n > slides.length) slideIndex = 1;
    if (n < 1) slideIndex = slides.length;

    for (let i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
    }
    for (let i = 0; i < dots.length; i++) {
      dots[i].classList.remove("active");
    }

    slides[slideIndex - 1].style.display = "block";
    dots[slideIndex - 1].classList.add("active");
  }

  function plusSlides(n) {
    showSlides(slideIndex += n);
  }

  function currentSlide(n) {
    showSlides(slideIndex = n);
  }

  // Initialize the first slide
  showSlides(slideIndex);

  // Add click events to prev/next buttons
  const prevButton = document.querySelector('.prev');
  const nextButton = document.querySelector('.next');
  
  if (prevButton && nextButton) {
    prevButton.addEventListener('click', () => plusSlides(-1));
    nextButton.addEventListener('click', () => plusSlides(1));
  }

  // Add click events to dots
  Array.from(dots).forEach((dot, index) => {
    dot.addEventListener('click', () => currentSlide(index + 1));
  });
});
</script>
{% endblock %}